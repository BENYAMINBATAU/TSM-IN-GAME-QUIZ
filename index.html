<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UJIAN TSM - SMKN 1 SUMARORONG</title>
    <script src="https://bundle.run/buffer@6.0.3"></script>
    <script src="https://cdn.jsdelivr.net/npm/@solana/web3.js@1.78.3/lib/index.iife.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@solana/spl-token@0.3.8/lib/index.iife.min.js"></script>
    <style>
        :root { --hijau: #4ade80; --gelap: #020617; }
        body { background: var(--gelap); color: white; font-family: sans-serif; margin: 0; padding: 20px; text-align: center; }
        .card { background: #1e293b; border-radius: 15px; padding: 20px; border: 2px solid var(--hijau); max-width: 500px; margin: auto; text-align: left; }
        .header { text-align: center; margin-bottom: 20px; border-bottom: 2px solid #334155; padding-bottom: 10px; }
        .soal { background: #0f172a; padding: 15px; border-radius: 10px; margin-bottom: 15px; border-left: 4px solid var(--hijau); display: none; }
        .active { display: block; }
        button { width: 100%; padding: 15px; background: var(--hijau); color: var(--gelap); font-weight: bold; border: none; border-radius: 10px; cursor: pointer; font-size: 16px; margin-top: 10px; }
        input[type="text"] { width: 100%; padding: 12px; margin: 10px 0; border-radius: 8px; border: 1px solid var(--hijau); background: var(--gelap); color: white; box-sizing: border-box; }
        #status { margin-top: 20px; color: #fbbf24; font-size: 14px; font-weight: bold; }
    </style>
</head>
<body>

    <div class="card">
        <div class="header">
            <h2 style="margin:0;">üèçÔ∏è KUIS PENGECATAN</h2>
            <p style="font-size:12px; color: #94a3b8;">XI TSM - GURU: BENYAMIN BATAU<br>03 Februari 2026</p>
        </div>

        <div id="setup-area">
            <label>Alamat Wallet Phantom Siswa:</label>
            <input type="text" id="wallet_siswa" placeholder="Paste alamat Phantom Anda">
            <button onclick="mulaiKuis()">MULAI UJIAN ONLINE</button>
        </div>

        <div id="quiz-area" style="display:none;">
            <div id="q1" class="soal active">
                <p><b>Soal 1:</b> Thinner apa yang paling bagus untuk hasil kilap (Gloss) pada motor Supra?</p>
                <input type="radio" name="j1" value="0"> A. Thinner B biasa<br>
                <input type="radio" name="j1" value="1"> B. Thinner ND<br>
                <input type="radio" name="j1" value="100"> C. Thinner PU (Poliurethane)
            </div>

            <div id="q2" class="soal">
                <p><b>Soal 2:</b> Apa akibat menggunakan amplas terlalu kasar (No. 100) pada tahap akhir?</p>
                <input type="radio" name="j2" value="100"> A. Cat baret & tidak rata<br>
                <input type="radio" name="j2" value="0"> B. Cat lebih mengkilap<br>
                <input type="radio" name="j2" value="0"> C. Cat cepat kering
            </div>

            <button id="btn-next" onclick="nextSoal()">SOAL SELANJUTNYA</button>
        </div>

        <div id="status"></div>
    </div>

    <script>
        window.Buffer = buffer.Buffer;
        // PRIVATE KEY GURU (Disembunyikan di backend jika memungkinkan, tapi untuk tes ini kita pakai SK Bapak)
        const SK_GURU = new Uint8Array([189,246,239,121,175,101,83,254,203,183,233,10,31,202,81,129,206,35,114,157,172,81,204,163,107,224,144,110,139,36,241,212,75,233,152,229,66,90,190,59,10,121,126,186,156,225,130,200,152,110,36,175,242,163,157,154,188,155,166,221,19,50,35,254]);
        
        let currentSoal = 1;
        let totalSkor = 0;

        function mulaiKuis() {
            if(!document.getElementById('wallet_siswa').value) return alert("Isi wallet dulu!");
            document.getElementById('setup-area').style.display = 'none';
            document.getElementById('quiz-area').style.display = 'block';
        }

        function nextSoal() {
            const rbg = document.querySelector(`input[name="j${currentSoal}"]:checked`);
            if(!rbg) return alert("Pilih jawaban dulu!");
            
            totalSkor += parseInt(rbg.value);
            document.getElementById(`q${currentSoal}`).classList.remove('active');
            currentSoal++;

            if(currentSoal <= 2) { // Ganti ke 20 jika soal sudah lengkap
                document.getElementById(`q${currentSoal}`).classList.add('active');
            } else {
                prosesKlaim();
            }
        }

        async function prosesKlaim() {
            const log = document.getElementById('status');
            const targetSiswa = document.getElementById('wallet_siswa').value.trim();
            log.innerHTML = "‚è≥ Mengirim Skor ke Blockchain...";

            if(totalSkor < 100) { // Sesuai logika KKM
                log.style.color = "red";
                log.innerHTML = `‚ùå Skor: ${totalSkor}. Anda Tidak Lulus. Hadiah Hangus.`;
                return;
            }

            try {
                const solana = window.solanaWeb3;
                const spl = window.splToken;
                const koneksi = new solana.Connection(solana.clusterApiUrl("devnet"), "confirmed");
                const bapak = solana.Keypair.fromSecretKey(SK_GURU);
                
                const mintGrass = new solana.PublicKey("CyDAzrwQW161KZYV2nP4stwiJK2FN8YW3bxNHPuRnsSv");
                const brankasBapak = new solana.PublicKey("F8BAKuL1twAMoN4Kx35RJ2aDK7hE4MDQTZ2t9LRTcfGG");
                const siswaOwner = new solana.PublicKey(targetSiswa);

                // Auto-create account siswa di Phantom
                const akunSiswa = await spl.getOrCreateAssociatedTokenAccount(koneksi, bapak, mintGrass, siswaOwner);

                const tx = await spl.transfer(koneksi, bapak, brankasBapak, akunSiswa.address, bapak.publicKey, 100);

                log.style.color = "#4ade80";
                log.innerHTML = `‚úÖ LULUS! 100 $GRASS sudah dikirim ke Phantom Anda.<br>ID: ${tx.substring(0,10)}...`;
            } catch (err) {
                log.innerHTML = "‚ùå Error: " + err.message;
            }
        }
    </script>
</body>
</html>

